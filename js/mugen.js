require=(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({"app":[function(require,module,exports){
var lastTime,fps,resource=require("resource"),requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvasWidth=720,canvasHeight=540,zoom=1;function main(e,t){var a=Date.now();fps=Math.ceil(1e3/(a-lastTime)),update(),render(e,t),lastTime=a,requestAnimFrame(function(){main(e,t)})}function loadCharacters(e,t){for(var a=[],n=0,r=e.length;n<r;n++){var i=e[n];a.push(new resource.resource(i.path,i.name))}Promise.all(a.map(function(e){return e.load()})).then(function(){t.call(this,a)})}function init(e,t){reset(),lastTime=Date.now(),main(e,t)}canvas.width=canvasWidth*zoom,canvas.height=canvasHeight*zoom,document.body.appendChild(canvas);var isGameOver,gameTime=0;function update(e){}function render(e,t){ctx.clearRect(0,0,canvasWidth,canvasHeight),renderPlayer(e),renderPlayer(t);var a="FPS:"+fps+" - action:"+e.action;ctx.fillStyle="#000",ctx.font="10px  Lucida Console",ctx.textBaseline="bottom",ctx.fillText(a,10,20)}function renderPlayer(e){ctx.save(),ctx.scale(e.right,1);var t=e.AIR[e.action].elements[e.currentFrame].groupNumber,a=e.AIR[e.action].elements[e.currentFrame].imageNumber,n=e.indexOf(t,a),r=resource.decodePCX(e.SFF.images[n].image,e.palette),i=1===e.right?0:r.width;ctx.drawImage(r,e.right*(e.pos.x-e.SFF.images[n].x)+e.right*i,e.pos.y-e.SFF.images[n].y),e.currentTime++,e.currentTime>=e.AIR[e.action].elements[e.currentFrame].time&&(e.currentTime=0,e.currentFrame++,e.currentFrame>=e.AIR[e.action].elements.length&&(e.currentFrame=0)),ctx.restore()}function reset(){isGameOver=!1,gameTime=0,score=0,ctx.scale(zoom||1,zoom||1)}module.exports={init:init,loadCharacters:loadCharacters};

},{"resource":"resource"}],"player":[function(require,module,exports){
function player(r){this.pos={x:0,y:0},this.action=0,this.currentFrame=0,this.currentTime=0,this.right=1,this.palette=null;var e=Object.prototype.hasOwnProperty;if("object"!=typeof r)throw TypeError("player - ressource incorrect");var t=Object(r);for(var i in t)e.call(t,i)&&(this[i]=t[i])}player.prototype={indexOf:function(r,e){if(null==this.SFF)throw new TypeError("indexOf - SFF not defined.");for(var t=0;t<this.SFF.images.length;t++)if(this.SFF.images[t].groupNumber===r&&this.SFF.images[t].imageNumber===e)return t;return-1}},module.exports={player:player};

},{}],"resource":[function(require,module,exports){
function imageDataToImage(e,t){var n=document.createElement("canvas");if(n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),void 0===t)return n;if("flipH"==t){var i=document.createElement("canvas");i.width=e.width,i.height=e.height;var r=i.getContext("2d");return r.scale(-1,1),r.drawImage(n,-e.width,0),i}}function decodePalette(e){for(var t=[],n=new DataView(e),i=0,r=0;r<256;r++){var a=[];a[0]=n.getUint8(i,!0),i+=1,a[1]=n.getUint8(i,!0),i+=1,a[2]=n.getUint8(i,!0),i+=1,t.push(a)}return t}function decodeACT(e){for(var t=[],n=new DataView(e),i=0,r=0;r<256;r++){var a=[];a[0]=n.getUint8(i,!0),i+=1,a[1]=n.getUint8(i,!0),i+=1,a[2]=n.getUint8(i,!0),i+=1,t.unshift(a)}return t}function decodePCX(e,t){var n,i,r={},a=new DataView(e),s=0;for(r.id=a.getUint8(s,!0),s+=1,r.version=a.getUint8(s,!0),s+=1,r.encoding=a.getUint8(s,!0),s+=1,r.bitPerPixel=a.getUint8(s,!0),s+=1,r.x=a.getUint16(s,!0),s+=2,r.y=a.getUint16(s,!0),s+=2,r.width=a.getUint16(s,!0),s+=2,r.height=a.getUint16(s,!0),s+=2,r.hres=a.getUint16(s,!0),s+=2,r.vres=a.getUint16(s,!0),s+=2,r.colorMap=[],n=0;n<16;n++)(i=[])[0]=a.getUint8(s,!0),s+=1,i[1]=a.getUint8(s,!0),s+=1,i[2]=a.getUint8(s,!0),s+=1,r.colorMap.push(i);if(r.reserved=a.getUint8(s,!0),s+=1,r.nbPlanes=a.getUint8(s,!0),s+=1,r.bpl=a.getUint16(s,!0),s+=2,r.paletteInfo=a.getUint16(s,!0),s+=2,r.palette=[],void 0===t)for(s=e.byteLength-769,r.signature=a.getUint8(s,!0),s+=1,n=0;n<256;n++)(i=[])[0]=a.getUint8(s,!0),s+=1,i[1]=a.getUint8(s,!0),s+=1,i[2]=a.getUint8(s,!0),s+=1,r.palette.push(i);else r.palette=t;s=128;var o=r.x,l=r.y;r.width++,r.height++;var c=new Uint8ClampedArray(r.width*r.height*4);for(n=0;n<r.width*r.height*4;)c[n++]=0;for(;l<r.height;){var u,g,h=a.getUint8(s,!0);for(s+=1,192==(192&h)?(u=63&h,g=a.getUint8(s,!0),s+=1):(u=1,g=h),n=0;n<u;n++){if(0!=g){var f=4*(o+l*r.width);c[f+0]=r.palette[g][0],c[f+1]=r.palette[g][1],c[f+2]=r.palette[g][2],c[f+3]=255}++o>=r.width&&(l++,o=r.x)}}var d=document.createElement("canvas");d.width=r.width,d.height=r.height;var p=d.getContext("2d"),m=p.createImageData(r.width,r.height);return m.data.set(c),p.putImageData(m,0,0),d}function decodeSFF(e){var t={},n=new DataView(e),i=0;t.signature=n.getString(i,12),i+=12,t.version=n.getString(i,4),i+=4,t.nbGroups=n.getUint32(i,!0),i+=4,t.nbImages=n.getUint32(i,!0),i+=4,t.posFirstSubFile=n.getUint32(i,!0),i+=4,t.length=n.getUint32(i,!0),i+=4,t.paletteType=n.getUint8(i,!0),i+=1,t.blank=n.getString(i,3),i+=3,t.comments=n.getString(i,476),i+=476,t.SF=[];var r=0;for(t.posFirstSubFile;r<t.nbImages;){var a={},s=n.getUint32(i,!0);i+=4;n.getUint32(i,!0);i+=4,a.x=n.getUint16(i,!0),i+=2,a.y=n.getUint16(i,!0),i+=2,a.groupNumber=n.getUint16(i,!0),i+=2,a.imageNumber=n.getUint16(i,!0),i+=2,a.indexPreviousCopy=n.getUint16(i,!0),i+=2,a.samePalette=n.getUint8(i,!0),i+=1;n.getString(i,14);i+=14,0==a.indexPreviousCopy&&(a.samePalette,a.image=n.extractBuffer(i,s)),0==r&&(t.palette=decodePalette(n.extractBuffer(s-767,s))),i=s,t.SF.push(a),r++}return{images:t.SF,palette:t.palette}}function decodeAIR(e){var t,n={action:/^\[Begin Action\s*(\d*)\s*\]$/,clsn2Default:/^Clsn2Default\s*:\s*(\d*)$/,clsn1:/^\Clsn1\s*:\s*(\d*)$/,clsn2:/^\Clsn2\s*:\s*(\d*)$/,clsn:new RegExp("^Clsn(\\d)\\[\\s*(\\d*)\\s*\\]\\s*\\=\\s*(-?\\d*?)\\s*,\\s*(-?\\d*?)\\s*,\\s*(-?\\d*?)\\s*,\\s*(-?\\d*?)$"),element:/^(-?\d*)\s*,\s*(\d*)\s*,\s*(-?\d*)\s*,\s*(-?\d*)\s*,\s*(-?\d*)$/},i=[],r=e.split(/\r\n|\r|\n/),a=null,s=null,o=null;return r.forEach(function(e){if(e=e.replace(/^\s+/,"").replace(/;.*/,"").replace(/\s+$/,""),n.action.test(e))t=e.match(n.action),a=t[1],clsn2Default=null,s=null,o=null,i[a]={};else if(n.clsn2Default.test(e))a&&(i[a].clsn2Default=[]);else if(n.clsn1.test(e))a&&(s=[]);else if(n.clsn2.test(e))a&&(o=[]);else if(n.clsn.test(e)){if(t=e.match(n.clsn),a){var r={x:+t[3],y:+t[4],x2:+t[5],y2:+t[6]};i[a].clsn2Default?i[a].clsn2Default.push(r):s?s.push(r):o&&o.push(r)}}else if(n.element.test(e)){var l={groupNumber:+(t=e.match(n.element))[1],imageNumber:+t[2],x:+t[3],y:+t[4],time:+t[5]};s&&(l.clsn1=s),o&&(l.clsn2=o),i[a].elements||(i[a].elements=[]),i[a].elements.push(l)}else 0!=e.length&&console.log("AIR - Line unknown : "+e)}),i}function decodeDEF(e){var t,n={section:/^\[\s*([^\]]*)\s*\]$/,param:/^([\w\.\-\_]+)\s*=\s*(.*?)$/},i={},r=e.split(/\r\n|\r|\n/),a=null;return r.forEach(function(e){e=e.replace(/^\s+/,"").replace(/;.*/,"").replace(/\s+$/,""),n.section.test(e)?(t=e.match(n.section),a=t[1].toLowerCase(),i[a]={}):n.param.test(e)?(t=e.match(n.param),a?i[a][t[1].toLowerCase()]=t[2]:i[t[1].toLowerCase()]=t[2]):0!=e.length&&console.log("DEF - Line unknown : "+e)}),i}function resource(e,t){this.path=e,this.name=t,this.DEF={},this.AIR=[],this.SFF={},this.ACT=[]}DataView.prototype.getString=function(e,t){for(var n,i="",r=0;r<t&&0!==(n=this.getUint8(r+e));r++)i+=String.fromCharCode(n);return i},DataView.prototype.extractBuffer=function(e,t){return this.buffer.slice(e-1,t)},resource.prototype={load:function(){var e=this;return new Promise(function(t,n){fetch(e.path+"/"+e.name+"/"+e.name+".def").then(function(e){return e.text()}).then(function(e){return decodeDEF(e)}).then(function(n){e.DEF=n;var i=new Promise(function(t,i){fetch(e.path+"/"+e.name+"/"+n.files.anim).then(function(e){return e.text()}).then(function(n){e.AIR=decodeAIR(n),t()})}),r=new Promise(function(t,i){fetch(e.path+"/"+e.name+"/"+n.files.sprite).then(function(e){return e.arrayBuffer()}).then(function(n){e.SFF=decodeSFF(n),t()})}),a=new Promise(function(t,i){fetch(e.path+"/"+e.name+"/"+n.files.pal1).then(function(e){return e.arrayBuffer()}).then(function(n){e.ACT.push(decodeACT(n)),t()})});Promise.all([i,r,a]).then(function(){t()})})})}},module.exports={decodePCX:decodePCX,resource:resource};

},{}]},{},["player","resource","app"]);
